# Imperial Thesis

## Context 

This repository contains my work for the Imperial College Master thesis project, in the scope of Applied Machine Learning course in Electrical and Electronic Engineering department. My goal is to spot MAFLD diseases in mice based on single-cell RNA sequencing (scRNA-seq) data from mice liver cells.

I applied various Machine Learning models to these data to find relevant insights on these data.

The dataset used for this study is taken from the Liver Cell Atlas : https://livercellatlas.org/index.php
It is the CD45+ sub dataset from the WD / SD dataset.

## Using the data

All data file should be placed in a `data` folder located at root and ignored by git. All scripts shold be runned from the root of the git repository.

## Use of the scripts

### Preprocessing

The scripts `Preprocessing_basic` and `Preprocessing_advanced` are designed to apply two classic preprocessing pipelines to the raw data. These scripts take as input the files `matrix.mtx`, `features.tsv`, `barcodes.tsv`, and `annotation.csv` from the selected dataset and output a CSV file containing the preprocessed data. These preprocessing transformations do not include the dimensionality reduction step, which is handled separately in another file. The goal is to run the preprocessing script only once and then apply various dimensionality reduction techniques. SCTransform is the Python implementation of the corresponding transformation, originally developed by Hafemeister and Satija in R.

### Models for preprocessed data

The scripts in this directory are designed to process the data generated by the scripts in the `Preprocessing` section and train machine learning models on these datasets.

The `ML_CD45_after_UMAP.py` script takes as input only the annotation file provided with the dataset. A UMAP dimensionality reduction (2 dimensions) step has already been applied to the dataset and is provided in the file. The classification is binary. The model is then trained on this data and evaluated.

Similarly, the `ML_CD45_after_UMAP_multi.py` script takes the same input but employs a multi-class approach. The model is evaluated using a confusion matrix, which is stored in the `data/plots` directory.

Finally, the `DimReduction_Model.py` script takes as input the CSV file produced by one of the preprocessing scripts in the `Preprocessing` section. It applies a dimensionality reduction technique (whose parameters can be specified) and then trains a machine learning model on this reduced dataset, evaluating its performance.  

### Raw models

The scripts of this section are designed to train machine learning models on the raw data and evaluate them. These scripts take as input the files `matrix.mtx`, `features.tsv`, `barcodes.tsv`, and `annotation.csv` from the selected dataset and output a CSV file containing the preprocessed data.

The `ML_CD45_raw_data.py` script uses a fully connected neural network, the `Xgboost_CD45_raw_data.py` script uses an XGBoost model and then performs some feature analysis to find the most important features. Some other models are then trained and evaluated on the reduced set of features.

The 2 other scripts in this directory are not very relevant. They are experimental approaches, replicating the same analysis using other datasets.

### Data analysis

The scripts contained in this directory are designed to process the data produced by the scripts in the `Raw Models` section and produce some insightful plots.

The `Feature_analysis.py` script analyzes the importance of features from a JSON file and generates a pie chart to visualize the distribution of feature importance. It reads the feature importance data file, sorts the features by importance, groups them, and calculates the sum of importance for each group. The resulting pie chart is saved in the `data/plots` directory.

The `Plots.py` script generates a plot to visualize the model accuracy based on the number of features used. It defines a list of feature numbers and corresponding accuracy values (taken from the ouput of the raw model scripts) and plots these values on a logarithmic scale, and saves the plot in the `data/plots` directory.